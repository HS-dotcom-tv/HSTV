<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HSTV - جداول المباريات</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', sans-serif; background: linear-gradient(135deg,#0f172a,#1e293b); min-height:100vh; color:#fff; }
    .match-card { transition: all .2s; backdrop-filter: blur(6px); }
    .match-card:hover { transform: translateY(-4px); background: rgba(30,41,59,0.75); }
    .btn-tab.active { background: linear-gradient(90deg,#10b981,#06b6d4); font-weight:700; color:white; }
    .crest { width:40px; height:40px; object-fit:contain; border-radius:6px; }
    .team-name { font-size: 0.9rem; font-weight: 600; text-align:center; }
    .status-text { font-size: 0.75rem; color: #94a3b8; text-align:center; }
    .score-box { font-size: 1.2rem; font-weight: 700; text-align:center; }
  </style>
</head>
<body class="p-4">

  <header class="text-center mb-6">
    <h1 class="text-4xl font-bold" style="background:linear-gradient(45deg,#10b981,#06b6d4); -webkit-background-clip:text; color:transparent">HSTV</h1>
    <p class="text-slate-400 mt-1">أحدث المباريات — مصنفة حسب الأهمية</p>
  </header>

  <div class="max-w-3xl mx-auto mb-6">
    <div class="flex gap-3">
      <button id="yesterday" class="btn-tab flex-1 px-4 py-2 rounded-xl bg-slate-700">الأمس</button>
      <button id="today" class="btn-tab flex-1 px-4 py-2 rounded-xl active">اليوم</button>
      <button id="tomorrow" class="btn-tab flex-1 px-4 py-2 rounded-xl bg-slate-700">الغد</button>
    </div>
  </div>

  <main id="matches" class="max-w-3xl mx-auto space-y-4"></main>

  <script>
    const API_URL = 'matches.json';
    const matchesContainer = document.getElementById('matches');

    const ALLOWED_COMPETITIONS = new Set(['CL','PL','PD','SA','BL1','FL1','WC','EC','AFCON']);
    const SPECIAL_ARAB_TEAMS = ['Al Hilal','Al Nassr','Al Ittihad','Al Ahly','Zamalek','Raja','Wydad','Esperance'];

    function setActiveTab(id) {
      document.querySelectorAll('.btn-tab').forEach(b => b.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function getDateString(offset = 0) {
      const d = new Date();
      d.setDate(d.getDate() + offset);
      return d.toISOString().split('T')[0];
    }

    function isImportantCompetition(league) {
      if (!league) return false;
      const code = league.code || '';
      if (ALLOWED_COMPETITIONS.has(code)) return true;
      return false;
    }

    function includeSpecialTeam(match) {
      const home = (match.teams.home.name || '').toLowerCase();
      const away = (match.teams.away.name || '').toLowerCase();
      return SPECIAL_ARAB_TEAMS.some(s => home.includes(s.toLowerCase()) || away.includes(s.toLowerCase()));
    }

    function formatTime(iso) {
      const d = new Date(iso);
      return d.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'Asia/Riyadh' });
    }

    async function loadMatches(view='today') {
      setActiveTab(view);
      matchesContainer.innerHTML = `<div class="text-center py-12 text-slate-400">جاري تحميل المباريات...</div>`;
      try {
        const res = await fetch(API_URL + '?t=' + Date.now());
        const data = await res.json();
        const all = data.response || [];
        renderMatches(all, view);
      } catch (err) {
        matchesContainer.innerHTML = `<div class="text-center py-12 text-red-400">فشل تحميل البيانات</div>`;
      }
    }

    function renderMatches(allMatches, view) {
      matchesContainer.innerHTML = '';
      const offset = view === 'yesterday' ? -1 : view === 'tomorrow' ? 1 : 0;
      const target = getDateString(offset);

      let filtered = allMatches.filter(m => {
        if (!m.fixture.date.startsWith(target)) return false;
        if (isImportantCompetition(m.league)) return true;
        if (includeSpecialTeam(m)) return true;
        return false;
      });

      if (!filtered.length) {
        matchesContainer.innerHTML = `<div class="text-center py-12 text-slate-400">⚽ لا توجد مباريات</div>`;
        return;
      }

      filtered.sort((a,b) => new Date(a.fixture.date) - new Date(b.fixture.date));

      filtered.forEach(match => {
        matchesContainer.innerHTML += renderMatchHTML(match);
      });
    }

    function renderMatchHTML(match) {
      const timeStr = formatTime(match.fixture.date);
      const status = match.fixture.status.short || 'NS';

      let centerTop = '';
      let centerBottom = '';

      if (["1H","2H","HT"].includes(status)) {
        centerTop = `<div class="score-box text-emerald-400">${match.goals.home || 0} - ${match.goals.away || 0}</div>`;
        centerBottom = `<div class="status-text text-red-400">مباشر</div>`;
      } else if (["FT","AET","PEN"].includes(status)) {
        centerTop = `<div class="score-box">${match.goals.home || 0} - ${match.goals.away || 0}</div>`;
        centerBottom = `<div class="status-text">انتهت</div>`;
      } else {
        centerTop = `<div class="score-box">${timeStr}</div>`;
        centerBottom = `<div class="status-text">لم يبدأ</div>`;
      }

      return `
        <div class="match-card border border-slate-700 rounded-xl p-4">
          <div class="flex items-center justify-between">
            <img src="${match.teams.home.logo}" class="crest" alt="" onerror="this.style.display='none'">
            ${centerTop}
            <img src="${match.teams.away.logo}" class="crest" alt="" onerror="this.style.display='none'">
          </div>
          <div class="flex items-center justify-between mt-2">
            <div class="team-name">${match.teams.home.name}</div>
            ${centerBottom}
            <div class="team-name">${match.teams.away.name}</div>
          </div>
        </div>
      `;
    }

    document.getElementById('yesterday').addEventListener('click', ()=> loadMatches('yesterday'));
    document.getElementById('today').addEventListener('click', ()=> loadMatches('today'));
    document.getElementById('tomorrow').addEventListener('click', ()=> loadMatches('tomorrow'));

    loadMatches('today');
    setInterval(()=>{ if (document.getElementById('today').classList.contains('active')) loadMatches('today'); }, 60000);
  </script>
</body>
</html>
