<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HSTV - جداول المباريات</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', sans-serif; background: linear-gradient(135deg,#0f172a,#1e293b); min-height:100vh; color:#fff; }
    .match-card { transition: all .2s; backdrop-filter: blur(6px); background: rgba(30,41,59,0.4); }
    .match-card:hover { transform: translateY(-4px); background: rgba(30,41,59,0.75); }
    .btn-tab.active { background: linear-gradient(90deg,#10b981,#06b6d4); font-weight:700; color:white; }
    .btn-tab { background:#1e293b; color:#cbd5e1; }
    .crest { 
        width: 50px; 
        height: 50px; 
        object-fit: contain; 
        margin: auto;
        border-radius: 50%;
        box-shadow: inset 0 0 0 1px rgba(100, 116, 139, 0.5);
    }
    .team-name { font-size: 0.85rem; font-weight: 600; text-align:center; line-height:1.2; word-break: break-word; }
    .status-text { font-size: 0.8rem; color: #94a3b8; text-align:center; }
    .score-box { font-size: 1.4rem; font-weight: 700; text-align:center; line-height: 1; /* لتحسين التمركز */ }
    .match-details {
      border-top: 1px solid #334155;
      margin-top: 1rem;
      padding-top: 0.75rem;
      font-size: 0.8rem;
      color: #94a3b8;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    /* -->> هذا هو الكود الجديد الخاص بكلمة "مساءً" -->> */
    .time-period {
        display: block; /* يجعلها في سطر جديد تحت التوقيت */
        font-size: 0.7rem; /* أصغر حجمًا */
        font-weight: 400; /* أخف وزنًا */
        color: #94a3b8; /* نفس لون النصوص الثانوية */
        opacity: 0.8; /* شفافية بسيطة */
        margin-top: 2px;
    }
  </style>
</head>
<body class="p-4">
  <header class="text-center mb-6">
    <h1 class="text-4xl font-bold" style="background:linear-gradient(45deg,#10b981,#06b6d4); -webkit-background-clip:text; color:transparent">HSTV</h1>
    <p class="text-slate-400 mt-1">أهم مباريات اليوم والأمس والغد</p>
  </header>
  <div class="max-w-3xl mx-auto mb-6">
    <div class="flex gap-3">
      <button id="yesterday" class="btn-tab flex-1 px-4 py-2 rounded-xl">الأمس</button>
      <button id="today" class="btn-tab flex-1 px-4 py-2 rounded-xl active">اليوم</button>
      <button id="tomorrow" class="btn-tab flex-1 px-4 py-2 rounded-xl">الغد</button>
    </div>
  </div>
  <main id="matches" class="max-w-3xl mx-auto space-y-4"></main>
  <script>
    const API_URL = 'matches.json';
    const matchesContainer = document.getElementById('matches');
    const leagueTranslations = {
      'PL': 'الدوري الإنجليزي', 'CL': 'دوري أبطال أوروبا', 'EC': 'بطولة أمم أوروبا', 'WC': 'كأس العالم',
      'PD': 'الدوري الإسباني', 'BL1': 'الدوري الألماني', 'SA': 'الدوري الإيطالي', 'FL1': 'الدوري الفرنسي',
      'PPL': 'الدوري البرتغالي', 'DED': 'الدوري الهولندي'
    };
    const brokenLogos = { '113': true, };

    function setActiveTab(id) { document.querySelectorAll('.btn-tab').forEach(b => b.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function getDateString(offset = 0) { const d = new Date(); d.setDate(d.getDate() + offset); return d.toISOString().split('T')[0]; }
    
    // -->> تم تعديل هذه الدالة لتُرجع جزأين منفصلين
    function formatTime(iso) {
        const d = new Date(iso);
        const timePart = d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true, timeZone: 'Asia/Riyadh' });
        const parts = timePart.split(' '); // تفصل الوقت عن AM/PM
        const time = parts[0];
        const period = parts[1].replace('AM', 'صباحًا').replace('PM', 'مساءً');
        return { time, period }; // تُرجع كائنًا يحتوي على الوقت وال فترة
    }

    async function loadMatches(view='today') {
      setActiveTab(view);
      matchesContainer.innerHTML = `<div class="text-center py-12 text-slate-400">جاري تحميل المباريات...</div>`;
      try {
        const res = await fetch(API_URL + '?t=' + Date.now());
        const data = await res.json();
        renderMatches(data.response || [], view);
      } catch (err) { matchesContainer.innerHTML = `<div class="text-center py-12 text-red-400">فشل تحميل البيانات</div>`; }
    }

    function renderMatches(allMatches, view) {
      matchesContainer.innerHTML = '';
      const offset = view === 'yesterday' ? -1 : view === 'tomorrow' ? 1 : 0;
      const target = getDateString(offset);
      let filtered = allMatches.filter(m => m.fixture.date && m.fixture.date.startsWith(target));
      if (!filtered.length) { matchesContainer.innerHTML = `<div class="text-center py-12 text-slate-400">⚽ لا توجد مباريات لهذا اليوم</div>`; return; }
      filtered.forEach(match => { matchesContainer.innerHTML += renderMatchHTML(match); });
    }

    function renderMatchHTML(match) {
      const status = match.fixture.status.short || 'NS';
      let centerTop = '', centerBottom = '';

      if (["LIVE", "HT"].includes(status)) {
        centerTop = `<div class="score-box text-emerald-400">${match.goals.home ?? 0} - ${match.goals.away ?? 0}</div>`;
        centerBottom = `<div class="status-text text-red-400">مباشر</div>`;
      } else if (["FT", "AET", "PEN"].includes(status)) {
        centerTop = `<div class="score-box">${match.goals.home ?? 0} - ${match.goals.away ?? 0}</div>`;
        centerBottom = `<div class="status-text">انتهت</div>`;
      } else {
        // -->> تم تعديل طريقة عرض التوقيت هنا
        const formattedTime = formatTime(match.fixture.date);
        centerTop = `<div class="score-box">${formattedTime.time}<span class="time-period">${formattedTime.period}</span></div>`;
        centerBottom = `<div class="status-text">لم تبدأ</div>`;
      }
      
      const leagueNameAr = leagueTranslations[match.league.code] || match.league.name;
      const competitionInfo = `<div class="match-details"><span>🏆 ${leagueNameAr}</span><span>🏟️ ${match.fixture.venue || 'ملعب غير محدد'}</span></div>`;
      const homeLogo = brokenLogos[match.teams.home.id] ? 'default-logo.svg' : (match.teams.home.logo || 'default-logo.svg');
      const awayLogo = brokenLogos[match.teams.away.id] ? 'default-logo.svg' : (match.teams.away.logo || 'default-logo.svg');

      return `<div class="match-card border border-slate-700 rounded-xl p-4"><div class="grid grid-cols-3 items-center text-center"><div><img src="${homeLogo}" class="crest" onerror="this.src='default-logo.svg';"></div><div>${centerTop}</div><div><img src="${awayLogo}" class="crest" onerror="this.src='default-logo.svg';"></div></div><div class="grid grid-cols-3 items-center text-center mt-2"><div class="team-name">${match.teams.home.name}</div><div>${centerBottom}</div><div class="team-name">${match.teams.away.name}</div></div>${competitionInfo}</div>`;
    }

    ['yesterday', 'today', 'tomorrow'].forEach(id => document.getElementById(id).addEventListener('click', () => loadMatches(id)));
    loadMatches('today');
    setInterval(() => { if (document.getElementById('today').classList.contains('active')) loadMatches('today'); }, 60000);
  </script>
</body>
</html>
