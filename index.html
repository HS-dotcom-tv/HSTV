<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HSTV - Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Cairo:wght@400;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
        /* -- Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ -- */
        --bg-gradient-start: #EFF6FF; --bg-gradient-end: #DBEAFE;
        --text-main: #1E293B; --text-secondary: #475569;
        --card-bg: rgba(255, 255, 255, 0.7); --card-hover-bg: rgba(255, 255, 255, 1);
        --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        --card-border: transparent;
        
        --btn-glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.2));
        --btn-glass-border: rgba(255, 255, 255, 0.3);
        --btn-glass-shadow: rgba(59, 130, 246, 0.05);
        --btn-text-color: var(--text-secondary);

        --btn-active-gradient-start: #3B82F6; --btn-active-gradient-end: #2563EB;
        --btn-active-text: #fff;
        --btn-active-shadow: 0 6px 20px -4px rgba(59, 130, 246, 0.4);

        /* -- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø´Ø¹Ø§Ø± (Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ) -- */
        --header-bg: linear-gradient(135deg, rgba(59, 130, 246, 0.6), rgba(37, 99, 235, 0.5));
        --header-border-top: rgba(255, 255, 255, 0.7);
        --header-border-bottom: rgba(255, 255, 255, 0.3);
        --header-shadow: 0 8px 32px 0 rgba(59, 130, 246, 0.25);
        --logo-text-hs-color: #FFFFFF;
        --logo-text-tv-color: rgba(255, 255, 255, 0.85);
        --logo-text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        --live-badge-color: #E50914; 
    }
    html.dark-mode {
        /* -- Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ -- */
        --bg-gradient-start: #141414; --bg-gradient-end: #141414;
        --text-main: #fff; --text-secondary: #A3A3A3;
        --card-bg: #282828; --card-hover-bg: #333333;
        --card-shadow: 0 0 0 0 transparent; --card-border: #282828;
        
        --btn-glass-bg: linear-gradient(135deg, rgba(40, 40, 40, 0.4), rgba(40, 40, 40, 0.2));
        --btn-glass-border: rgba(255, 255, 255, 0.1);
        --btn-glass-shadow: rgba(0, 0, 0, 0.3);
        --btn-text-color: var(--text-secondary);

        --btn-active-gradient-start: #B9090B; --btn-active-gradient-end: #990709;
        --btn-active-text: #fff;
        --btn-active-shadow: 0 6px 20px -4px rgba(185, 9, 11, 0.4);

        /* -- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø´Ø¹Ø§Ø± (Ø§Ù„Ù„ÙŠÙ„ÙŠ) -- */
        --header-bg: linear-gradient(135deg, rgba(185, 9, 11, 0.6), rgba(153, 7, 9, 0.5));
        --header-border-top: rgba(255, 255, 255, 0.2);
        --header-border-bottom: rgba(255, 255, 255, 0.1);
        --header-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        --logo-text-hs-color: #000000;
        --logo-text-tv-color: rgba(0, 0, 0, 0.85);
        --logo-text-shadow: 0 1px 2px rgba(255, 255, 255, 0.15);
        --live-badge-color: #FFFFFF; 
    }
    
    body { 
        font-family: 'Cairo', sans-serif; 
        background-color: var(--bg-gradient-start);
        background-image: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end)); 
        min-height:100vh; color: var(--text-main);
        transition: background 0.4s ease, color 0.4s ease;
    }
    .match-card { 
        transition: all .2s ease-in-out; 
        background: var(--card-bg); border: 1px solid var(--card-border);
        box-shadow: var(--card-shadow); border-radius: 0.75rem;
    }
    html.dark-mode .match-card {
        backdrop-filter: none; border-radius: 0.25rem; border: none;
    }
    .match-card:hover { 
        transform: translateY(-5px); background: var(--card-hover-bg); 
    }
    html.dark-mode .match-card:hover {
        transform: scale(1.03) translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.5);
    }

    .main-tab, .date-tab {
        background: var(--btn-glass-bg);
        border: 1px solid var(--btn-glass-border);
        box-shadow: 0 2px 10px var(--btn-glass-shadow);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        color: var(--btn-text-color);
        transition: all .3s ease;
        border-radius: 14px;
        font-weight: 600;
        padding: 0.5rem 1rem;
    }
    .main-tab:hover, .date-tab:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px var(--btn-glass-shadow);
    }
    .main-tab.active, .date-tab.active { 
        background: linear-gradient(90deg, var(--btn-active-gradient-start), var(--btn-active-gradient-end)); 
        color: var(--btn-active-text);
        border: none;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        box-shadow: var(--btn-active-shadow);
        transform: translateY(-1px);
    }
    .date-tab {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
        border-radius: 12px;
    }
    .date-tabs-container {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out;
    }
    .date-tabs-container.visible {
        max-height: 100px;
        margin-top: 0.75rem;
    }

    .header {
        background: var(--header-bg);
        border-top: 1px solid var(--header-border-top);
        border-bottom: 1px solid var(--header-border-bottom);
        box-shadow: var(--header-shadow);
        backdrop-filter: blur(18px);
        -webkit-backdrop-filter: blur(18px);
        transition: all 0.3s ease;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        position: relative;
        display: flex; 
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding: 0.5rem 1rem; 
    }
    .header-side {
        flex: 1; display: flex;
    }
    .header-side.left { justify-content: flex-start; }
    .header-side.right { justify-content: flex-end; }
    .header-center {
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        justify-content: center;
        position: absolute; 
        left: 50%;
        transform: translateX(-50%);
    }
    .logo-card {
        background: none; border: none; box-shadow: none;
        backdrop-filter: none; -webkit-backdrop-filter: none; padding: 0;
        margin-bottom: 2px; 
    }
    .logo-text {
        font-family: 'Montserrat', sans-serif; 
        font-size: 24px; 
        font-weight: 700; line-height: 1; letter-spacing: 1.5px;
        text-shadow: var(--logo-text-shadow); white-space: nowrap;
        transition: color 0.4s ease, text-shadow 0.4s ease;
    }

    .logo-text .hs-part { color: var(--logo-text-hs-color); }
    .logo-text .tv-part { color: var(--logo-text-tv-color); margin-right: 2px; }

    .live-badge {
        display: flex; align-items: center; gap: 4px;
        font-size: 0.7rem; font-family: 'Cairo', sans-serif;
        font-weight: 600; 
        color: var(--live-badge-color); 
        transition: color 0.4s ease; 
    }
    .live-dot {
        width: 6px; height: 6px; 
        background-color: var(--live-badge-color); 
        border-radius: 50%; animation: pulse 1.5s infinite;
        transition: background-color 0.4s ease; 
    }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

    #theme-toggle {
        width: 36px; height: 36px;
        display: flex; align-items: center; justify-content: center;
        background: var(--btn-bg); border: 1px solid var(--btn-border);
        border-radius: 50%; color: var(--text-main);
        cursor: pointer; transition: all 0.2s ease;
    }
    #theme-toggle:hover { 
        transform: scale(1.1);
        box-shadow: 0 4px 15px var(--btn-glass-shadow);
    }
    
    .page-section { display: none; }
    .page-section.active { display: block; }
    
    .crest { 
        width: 50px; height: 50px; object-fit: contain; margin: auto;
        border-radius: 50%;
    }
    .score-box { font-size: 1.4rem; font-weight: 700; text-align:center; line-height: 1; color: var(--text-main);}
    .team-name { font-size: 0.85rem; font-weight: 600; text-align:center; line-height:1.2; word-break: break-word; }
    .status-text, .time-period, .match-details { color: var(--text-secondary); }
    .match-details { 
      border-top: 1px solid var(--card-border); 
      margin-top: 1rem; padding-top: 0.75rem;
      font-size: 0.75rem; font-weight: 400; 
      display: flex; justify-content: space-between; align-items: center;
    }
    .time-period { display: block; font-size: 0.7rem; font-weight: 400; opacity: 0.8; margin-top: 2px; }

    /* --- Ø£ÙƒÙˆØ§Ø¯ Ù‚Ø³Ù… Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± --- */
    .channel-filters {
      display: flex; gap: 0.75rem; margin-bottom: 1.5rem; max-w-3xl; margin-left: auto; margin-right: auto;
    }
    .channel-filter-btn {
        background: var(--btn-glass-bg); border: 1px solid var(--btn-glass-border); box-shadow: 0 2px 10px var(--btn-glass-shadow);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); color: var(--btn-text-color);
        transition: all .3s ease; border-radius: 12px; font-weight: 600; padding: 0.5rem 1rem; flex: 1;
    }
    .channel-filter-btn.active {
        background: linear-gradient(90deg, var(--btn-active-gradient-start), var(--btn-active-gradient-end)); color: var(--btn-active-text); border: none;
        backdrop-filter: none; -webkit-backdrop-filter: none; box-shadow: var(--btn-active-shadow);
    }
    .channels-view { display: none; } 
    .channels-view.visible { display: block; }
    .channel-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1.25rem; max-w-3xl; margin: auto;
    }
    .package-grid {
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    .channel-card-wrapper { position: relative; }
    .channel-card, .package-card-item {
      background: var(--card-bg); border: 1px solid var(--card-border); box-shadow: var(--card-shadow);
      border-radius: 16px; padding: 1rem; aspect-ratio: 1 / 1; 
      display: flex; flex-direction: column; 
      align-items: center; justify-content: center;
      transition: all 0.3s ease; cursor: pointer;
      position: relative;
    }
    .channel-card:hover, .package-card-item:hover {
      transform: translateY(-6px); box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.15);
    }
    html.dark-mode .channel-card:hover, html.dark-mode .package-card-item:hover { box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.4); }
    .channel-logo, .package-logo {
      width: 100%; height: auto; max-height: 80%;
      object-fit: contain;
    }
    .channel-card .channel-logo {
        max-height: 70%;
    }
    .channel-name { 
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.5rem;
        color: var(--text-main);
        text-align: center; line-height: 1;
        position: absolute;
        bottom: 0.75rem;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
    }
    .quality-options {
      display: flex; gap: 0.5rem; justify-content: center; margin-top: 0.5rem; max-height: 0;
      overflow: hidden; transition: max-height 0.4s ease-out, margin-top 0.4s ease-out;
    }
    .channel-card-wrapper.expanded .quality-options { max-height: 50px; }
    .quality-btn {
      background-color: rgba(0,0,0,0.1); color: var(--text-secondary); border-radius: 6px;
      padding: 0.2rem 0.6rem; font-size: 0.7rem; font-weight: 600; transition: all 0.2s ease;
      cursor: pointer; border: none;
    }
    html.dark-mode .quality-btn { background-color: rgba(255,255,255,0.1); }
    .quality-btn:hover { background-color: var(--btn-active-gradient-start); color: #fff; }
    .back-btn { margin-bottom: 1rem; width: fit-content; }
    
    /* --- 2. Ø¥Ø¶Ø§ÙØ© ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) --- */
    .modal-overlay {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex; align-items: center; justify-content: center;
        z-index: 1000;
        opacity: 0; visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .modal-overlay.visible {
        opacity: 1; visibility: visible;
    }
    .modal-container {
        width: 90%; max-width: 800px;
        background: var(--card-bg);
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        padding: 1rem;
        transform: scale(0.9);
        transition: transform 0.3s ease;
    }
    .modal-overlay.visible .modal-container {
        transform: scale(1);
    }
    .modal-header {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 1rem;
    }
    #modal-channel-title {
        font-weight: 700;
        color: var(--text-main);
    }
    .close-btn {
        background: none; border: none; font-size: 1.5rem;
        color: var(--text-secondary); cursor: pointer; line-height: 1;
    }
    /* ØªØ¹Ø¯ÙŠÙ„ ØªØµÙ…ÙŠÙ… Plyr Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø«ÙŠÙ… */
    :root {
      --plyr-color-main: #3B82F6;
    }
    html.dark-mode {
      --plyr-color-main: #B9090B;
    }
  </style>
  
  <script>
    (function() {
      if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('dark-mode');
      }
    })();
  </script>
</head>
<body class=""> 
  <header class="header">
    <div class="header-side left">
      <button id="theme-toggle" title="ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹"></button>
    </div>
    <div class="header-center">
      <div class="logo-card">
          <span class="logo-text">
            <span class="hs-part">HS</span><span class="tv-part">TV</span>
          </span>
      </div>
      <div class="live-badge">
        <span class="live-dot"></span>
        <span>Ù…Ø¨Ø§Ø´Ø±</span>
      </div>
    </div>
    <div class="header-side right"></div>
  </header>
  
  <div class="page-content p-4">
    <div class="max-w-3xl mx-auto mb-6">
      <div class="navigation-container">
          <div class="main-tabs flex gap-3">
            <button id="matches-btn" data-section="matches-section" class="main-tab flex-1">Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</button>
            <button id="channels-btn" data-section="channels-section" class="main-tab flex-1">Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</button>
            <button id="news-btn" data-section="news-section" class="main-tab flex-1">Ø£Ø®Ø¨Ø§Ø±</button>
          </div>
          <div id="date-tabs-container" class="date-tabs-container">
              <div class="date-tabs flex gap-3">
                <button id="yesterday" class="date-tab flex-1">Ø§Ù„Ø£Ù…Ø³</button>
                <button id="today" class="date-tab flex-1 active">Ø§Ù„ÙŠÙˆÙ…</button>
                <button id="tomorrow" class="date-tab flex-1">Ø§Ù„ØºØ¯</button>
              </div>
          </div>
      </div>
    </div>

    <main>
      <div id="matches-section" class="page-section">
          <div id="matches" class="max-w-3xl mx-auto space-y-4"></div>
      </div>

      <div id="channels-section" class="page-section">
          <div id="channel-filters-container" class="channel-filters">
              <button class="channel-filter-btn active" data-category="sports">Ø±ÙŠØ§Ø¶ÙŠØ©</button>
              <button class="channel-filter-btn" data-category="news">Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©</button>
              <button class="channel-filter-btn" data-category="international">Ø¹Ø§Ù„Ù…ÙŠØ©</button>
          </div>
          
          <div id="packages-view" class="channels-view">
            <div id="packages-grid" class="channel-grid package-grid" dir="ltr"></div>
          </div>

          <div id="channels-view" class="channels-view">
            <button id="back-to-packages-btn" class="date-tab back-btn"> &larr; Ø¹ÙˆØ¯Ø© </button>
            <div id="channels-grid" class="channel-grid" dir="ltr"></div>
          </div>
      </div>

      <div id="news-section" class="page-section">
          <div class="text-center py-12 text-slate-400"> ğŸ“° Ù‚Ø³Ù€Ù… Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø³ÙŠØªÙˆÙØ± Ù‚Ø±ÙŠØ¨Ø§Ù‹... </div>
      </div>
    </main>
  </div>
  
  <div id="player-modal" class="modal-overlay">
      <div class="modal-container">
          <div class="modal-header">
              <span id="modal-channel-title"></span>
              <button id="close-modal-btn" class="close-btn">&times;</button>
          </div>
          <div class="player-container">
              <video id="video-player" playsinline controls></video>
          </div>
      </div>
  </div>

  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const mainTabs = document.querySelectorAll('.main-tab');
        const pageSections = document.querySelectorAll('.page-section');
        const dateTabsContainer = document.getElementById('date-tabs-container');
        
        const savedTabId = localStorage.getItem('activeTab') || 'matches-section';
        document.querySelector('.main-tab.active')?.classList.remove('active');
        document.querySelector('.page-section.active')?.classList.remove('active');
        const tabToActivate = document.querySelector(`[data-section="${savedTabId}"]`);
        const sectionToActivate = document.getElementById(savedTabId);

        if (tabToActivate && sectionToActivate) {
            tabToActivate.classList.add('active');
            sectionToActivate.classList.add('active');
        }
        if (savedTabId === 'matches-section') {
            dateTabsContainer.classList.add('visible');
        } else {
            dateTabsContainer.classList.remove('visible');
        }

        mainTabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                if(e.target.classList.contains('back-btn')) return;
                mainTabs.forEach(t => t.classList.remove('active'));
                pageSections.forEach(s => s.classList.remove('active'));
                tab.classList.add('active');
                const sectionId = tab.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
                localStorage.setItem('activeTab', sectionId);
                if (sectionId === 'matches-section') { dateTabsContainer.classList.add('visible'); } 
                else { dateTabsContainer.classList.remove('visible'); }
            });
        });

        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>`;
        const moonIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>`;
        
        function updateChannelLogos() {
            const isDarkMode = document.documentElement.classList.contains('dark-mode');
            document.querySelectorAll('img.dynamic-logo').forEach(img => {
                img.src = isDarkMode ? img.dataset.darkSrc : img.dataset.lightSrc;
            });
        }

        function updateIcon() { 
            if (document.documentElement.classList.contains('dark-mode')) { themeToggle.innerHTML = sunIcon; } 
            else { themeToggle.innerHTML = moonIcon; } 
            updateChannelLogos(); 
        }
        
        themeToggle.addEventListener('click', () => { 
            document.documentElement.classList.toggle('dark-mode'); 
            localStorage.setItem('theme', document.documentElement.classList.contains('dark-mode') ? 'dark' : 'light'); 
            updateIcon(); 
        });
        
        // --- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ---
        const API_URL = 'matches.json';
        const matchesContainer = document.getElementById('matches');
        function loadMatches(view='today') { /* ... Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ... */ }
        if (savedTabId === 'matches-section') { loadMatches('today'); }
        
        // --- Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ù…Ø­Ø¯Ø« Ø§Ù„Ø®Ø§Øµ Ø¨Ù‚Ø³Ù… Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ---
        const channelsDataUrl = 'channels.json';
        const packagesView = document.getElementById('packages-view');
        const channelsView = document.getElementById('channels-view');
        const packagesGrid = document.getElementById('packages-grid');
        const channelsGrid = document.getElementById('channels-grid');
        const filterBtns = document.querySelectorAll('.channel-filter-btn');
        const backToPackagesBtn = document.getElementById('back-to-packages-btn');
        let allChannelsData = {};
        let currentCategory = 'sports';

        // --- 5. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„ ÙˆØ§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ---
        const playerModal = document.getElementById('player-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const modalChannelTitle = document.getElementById('modal-channel-title');
        const videoElement = document.getElementById('video-player');
        const player = new Plyr(videoElement, {
            captions: { active: false, language: 'auto', update: false },
            tooltips: { controls: true, seek: true }
        });
        let hls = new Hls();
        
        function playStream(url, channelName) {
            modalChannelTitle.textContent = channelName;
            if (Hls.isSupported()) {
                hls.loadSource(url);
                hls.attachMedia(videoElement);
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = url;
            }
            playerModal.classList.add('visible');
            player.play();
        }

        function stopStream() {
            player.stop();
            playerModal.classList.remove('visible');
        }

        closeModalBtn.addEventListener('click', stopStream);
        playerModal.addEventListener('click', (e) => {
            if (e.target === playerModal) { // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
                stopStream();
            }
        });
        // --- Ù†Ù‡Ø§ÙŠØ© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„ ---


        function switchView(viewToShow) { /* ... Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ... */ }
        function getShortChannelName(fullName) { /* ... Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ... */ }
        function renderPackages(category) { /* ... Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ... */ }

        function renderPackageChannels(packageId) {
            switchView('channels');
            channelsGrid.innerHTML = '';
            const packages = allChannelsData[currentCategory] || [];
            const selectedPackage = packages.find(p => p.package_id === packageId);
            if (!selectedPackage) return;

            selectedPackage.channels.forEach(channel => {
                 const qualityButtonsHTML = Object.keys(channel.streams).map(quality => 
                    `<button class="quality-btn" data-stream-src="${channel.streams[quality]}">${quality.toUpperCase()}</button>`
                ).join('');

                const shortName = getShortChannelName(channel.name);

                const cardHTML = `
                    <div class="channel-card-wrapper" id="${channel.id}" data-full-name="${channel.name}">
                        <div class="channel-card">
                            <img class="dynamic-logo channel-logo" data-light-src="${channel.logo.light}" data-dark-src="${channel.logo.dark}" alt="${channel.name}" onerror="this.style.display='none';">
                            <span class="channel-name">${shortName}</span>
                        </div>
                        <div class="quality-options">${qualityButtonsHTML}</div>
                    </div>
                `;
                channelsGrid.innerHTML += cardHTML;
            });
            updateChannelLogos();
        }

        async function loadChannels() { /* ... Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ... */ }
        
        filterBtns.forEach(btn => { /* ... Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ... */ });
        packagesGrid.addEventListener('click', e => { /* ... Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ... */ });

        channelsGrid.addEventListener('click', (e) => {
            // --- ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ---
            const qualityBtn = e.target.closest('.quality-btn');
            if (qualityBtn) {
                const streamUrl = qualityBtn.dataset.streamSrc;
                if(streamUrl && streamUrl !== '#') {
                    const cardWrapper = qualityBtn.closest('.channel-card-wrapper');
                    const channelName = cardWrapper.dataset.fullName;
                    playStream(streamUrl, channelName);
                }
                return;
            }

            const cardWrapper = e.target.closest('.channel-card-wrapper');
            if (cardWrapper && e.target.closest('.channel-card')) { 
                document.querySelectorAll('.channel-card-wrapper.expanded').forEach(cw => {
                    if (cw.id !== cardWrapper.id) cw.classList.remove('expanded');
                });
                cardWrapper.classList.toggle('expanded');
            }
        });

        backToPackagesBtn.addEventListener('click', () => renderPackages(currentCategory));
        
        loadChannels();
        updateIcon();
        // --- Ù†Ø³Ø® ÙˆÙ„ØµÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù‡Ù†Ø§ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ù„Ù…Ø³Ù‡ ---
        function getShortChannelName(fullName) {return fullName.replace('beIN Sports', '').replace('beIN', '').replace('SSC', '').replace('DAZN', '').replace('Sky Sports', '').trim();}
        function switchView(viewToShow) {if (viewToShow === 'packages') {packagesView.classList.add('visible'); channelsView.classList.remove('visible');} else {packagesView.classList.remove('visible'); channelsView.classList.add('visible');}}
        function renderPackages(category) {switchView('packages'); packagesGrid.innerHTML = ''; const packages = allChannelsData[category] || []; if (packages.length === 0) {packagesGrid.innerHTML = `<div class="text-center text-slate-400 col-span-full">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù‚Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</div>`; return;} packages.forEach(pkg => {const packageHTML = `<div class="package-card-item" data-package-id="${pkg.package_id}"><img class="dynamic-logo package-logo" data-light-src="${pkg.package_logo.light}" data-dark-src="${pkg.package_logo.dark}" alt="${pkg.package_name}" onerror="this.style.display='none';"></div>`; packagesGrid.innerHTML += packageHTML;}); updateChannelLogos();}
        async function loadChannels() {try {const res = await fetch(channelsDataUrl + '?t=' + Date.now()); allChannelsData = await res.json(); renderPackages(currentCategory); } catch(err) {console.error(err); packagesGrid.innerHTML = `<div class="text-center text-red-400 col-span-full">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ù†ÙˆØ§Øª.</div>`;}}
        filterBtns.forEach(btn => {btn.addEventListener('click', () => {filterBtns.forEach(b => b.classList.remove('active')); btn.classList.add('active'); currentCategory = btn.dataset.category; renderPackages(currentCategory);});});
        packagesGrid.addEventListener('click', e => {const packageCard = e.target.closest('.package-card-item'); if (packageCard) {renderPackageChannels(packageCard.dataset.packageId);}});
    });
  </script>
</body>
</html>
